#!/bin/bash

DIR="pokemon_data"
OUT="pokemon_report.csv"

# Header for CSV
echo "Name,Height (m),Weight (kg)" > "$OUT"

# Loop through JSON files
for file in "$DIR"/*.json; do
    # Extract fields
    NAME=$(jq -r '.name' "$file")
    HEIGHT=$(jq -r '.height' "$file")   # dm
    WEIGHT=$(jq -r '.weight' "$file")   # hg

    # Convert to meters and kilograms
    HEIGHT_M=$(awk "BEGIN { printf \"%.1f\", $HEIGHT / 10 }")
    WEIGHT_KG=$(awk "BEGIN { printf \"%.1f\", $WEIGHT / 10 }")

    # Capitalize the name
    NAME_CAP=$(echo "$NAME" | sed 's/.*/\u&/')

    echo "$NAME_CAP,$HEIGHT_M,$WEIGHT_KG" >> "$OUT"
done

echo ""
echo "CSV Report generated at: $OUT"
echo ""

# Print CSV content nicely
cat "$OUT"
echo ""

# Calculate averages with awk
awk -F',' 'NR>1 { h += $2; w += $3; count++ }
    END {
        printf "Average Height: %.2f m\n", h / count;
        printf "Average Weight: %.2f kg\n", w / count;
    }' "$OUT"
